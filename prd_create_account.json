{"collection":{"info":{"_postman_id":"0182cf57-66c6-45be-a6eb-467687ce1c12","name":"PRD_CreatAccount & KYC","schema":"https://schema.getpostman.com/json/collection/v2.1.0/collection.json","updatedAt":"2025-07-15T08:27:13.000Z","createdAt":"2025-03-21T05:39:13.000Z","lastUpdatedBy":"37399927","uid":"37399927-0182cf57-66c6-45be-a6eb-467687ce1c12"},"item":[{"name":"prd_MIS captcha","id":"71043b32-7cbd-4a29-9341-e752d8357600","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"POST","header":[{"key":"callType","value":"app","type":"text"},{"key":"lang","value":"zh-CN","type":"text"},{"key":"Conent-Type","value":"application/x-www-form-urlencoded; charset=UTF-8","type":"text"},{"key":"x-requested-with","value":"XMLHttpRequest","type":"text"},{"key":"sec-fetch-mode","value":"cors","type":"text"},{"key":"sec-ch-ua-platform","value":"\"Windows\"","type":"text"},{"key":"user-agent","value":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36","type":"text"},{"key":"sec-ch-ua","value":"\"Not A(Brand\";v=\"8\", \"Chromium\";v=\"132\", \"Google Chrome\";v=\"132\"","type":"text"},{"key":"sec-ch-ua-mobile","value":"?0","type":"text"},{"key":"origin","value":"https://nmis.gtsuat.com","type":"text"},{"key":"sec-fetch-site","value":"same-origin","type":"text"},{"key":"sec-fetch-dest","value":"empty","type":"text"},{"key":"referer","value":"https://nmis.tsgol.org/toLogin","type":"text"},{"key":"accept-encoding","value":"gzip, deflate, br, zstd","type":"text"},{"key":"accept-language","value":"zh-TW,zh;q=0.9,en-US;q=0.8,en;q=0.7","type":"text"}],"body":{"mode":"urlencoded","urlencoded":[{"key":"username","value":"jimmy.kao","type":"text"},{"key":"password","value":"Aa123123,","type":"text"},{"key":"code","value":"1234","type":"text"}]},"url":{"raw":"https://nmis.tsgol.org/user/login/login2fa","protocol":"https","host":["nmis","tsgol","org"],"path":["user","login","login2fa"]}},"response":[],"uid":"37399927-71043b32-7cbd-4a29-9341-e752d8357600"},{"name":"prd_MIS 取得驗證碼","event":[{"listen":"test","script":{"id":"a9a7ebb1-9d79-46c8-8e0f-d87bfca68385","exec":["pm.environment.set('prd_registerCode',null);\r","pm.test('成功', () => {\r","    const json = pm.response.json();\r","\r","    pm.environment.set('prd_registerCode', json.data);\r","\r","    // 印出到 Postman Console\r","    console.log(\"prd_registerCode:\", json.data);\r","});\r","const mobile = pm.variables.get(\"mobilePhone\");\r","console.log(\"mobilePhone:\", mobile);"],"type":"text/javascript","packages":{}}},{"listen":"prerequest","script":{"id":"dac04fc9-a632-4ed8-8f50-bccb2079497a","exec":["const requestBody = JSON.parse(pm.request.body.raw);\r","\r","pm.environment.set(\"prd_creadtAccuontName\",requestBody.mobilePhone);\r","\r",""],"type":"text/javascript","packages":{}}}],"id":"9b68be82-4d6c-4d4e-867f-09d7b9f7e205","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"POST","header":[{"key":"callType","value":"app","type":"text"},{"key":"token","value":"{{uat_token}}","type":"text","disabled":true},{"key":"lang","value":"zh-CN","type":"text"}],"body":{"mode":"raw","raw":"{\r\n    \"mobilePhone\":\"{{mobilePhone}}\", \r\n    \"category\":\"0\"\r\n}","options":{"raw":{"language":"json"}}},"url":{"raw":"https://nmis.tsgol.org/ValidateCodeLog/createValidateNo","protocol":"https","host":["nmis","tsgol","org"],"path":["ValidateCodeLog","createValidateNo"]}},"response":[],"uid":"37399927-9b68be82-4d6c-4d4e-867f-09d7b9f7e205"},{"name":"prd_creatAccount","event":[{"listen":"test","script":{"id":"167117eb-2c27-485c-af85-cf4262b64977","exec":["pm.environment.set('prd_UpdateUUid',null);\r","pm.test('成功', () => {\r","    const json = pm.response.json();\r","\r","    pm.environment.set('prd_UpdateUUid', json.data.updateCustomerUuid);\r","});\r","\r","let jsonData = pm.response.json();\r","console.log(\"🔐 建立帳號 JSON Response:\", JSON.stringify(jsonData, null, 2));\r","\r","const response = pm.response.json();\r","\r","if (response.code === \"FAIL\") {\r","    console.log(\"❌ Test result: Failed - code = FAIL\");\r","    pm.test(\"Test failed\", function () {\r","        pm.expect(response.code).to.not.eql(\"FAIL\");\r","    });\r","} else {\r","    console.log(\"✅ Test result: Passed\");\r","    pm.test(\"Test passed\", function () {\r","        pm.expect(response.code).to.eql(\"OK\");\r","    });\r","}\r",""],"type":"text/javascript","packages":{}}},{"listen":"prerequest","script":{"id":"4a2a6d95-f9ac-485e-ab65-a362ae5eecd5","exec":["const mobile = pm.variables.get(\"mobilePhone\");\r","console.log(\"mobilePhone:\", mobile);"],"type":"text/javascript","packages":{}}}],"id":"a7275c4d-5f82-4679-b38f-47f4287d4e4a","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"POST","header":[{"key":"callType","value":"app","type":"text"},{"key":"token","value":"{{uat_token}}","type":"text","disabled":true},{"key":"lang","value":"zh-CN","type":"text"}],"body":{"mode":"raw","raw":"{\r\n\t\"password\": \"{{password}}\",\r\n\t\"userLevel\": \"MIN\",\r\n\t\"apiVersion\": \"v1\",\r\n\t\"mobilePhone\": \"{{mobilePhone}}\",\r\n\t\"captcha\": {{prd_registerCode}},\r\n\t\"signature\": \"\",\r\n\t\"driverType\": \"2\",\r\n\t\"mark\": \"\"\r\n}","options":{"raw":{"language":"json"}}},"url":{"raw":"{{prd}}/customer/createAccount","host":["{{prd}}"],"path":["customer","createAccount"]}},"response":[],"uid":"37399927-a7275c4d-5f82-4679-b38f-47f4287d4e4a"},{"name":"prd_login","event":[{"listen":"test","script":{"id":"1f4181ab-fe7c-4ae9-b6b5-4179425dfb86","exec":["pm.environment.set('prd_token',null);\r","pm.environment.set('prd_username',null)\r","pm.test('成功', () => {\r","    const json = pm.response.json();\r","\r","    pm.environment.set('prd_token', json.data.token);\r","    pm.environment.set('prd_username',json.data.username);\r","});\r","\r","// 將 request 的 body 拿出來（字串格式）\r","const requestBodyRaw = pm.request.body.raw;\r","\r","// 轉為 JSON 物件\r","const requestBody = JSON.parse(requestBodyRaw);\r","\r","// 取得 username\r","const phoneNumber = requestBody.username;\r","\r","// 印出確認\r","console.log(\"📦 儲存的 phoneNumber:\", phoneNumber);\r","\r","// 儲存到環境變數中\r","pm.environment.set(\"saved_username\", phoneNumber);\r","\r","// 解析回應 JSON\r","const response = pm.response.json();\r","\r","// 檢查是否存在 data.username\r","if (response.data && response.data.username) {\r","    const username = response.data.username;\r","\r","    // 儲存為 8xxID 環境變數\r","    pm.environment.set(\"8xxID\", username);\r","\r","    console.log(\"✅ 已儲存 username 為 8xxID:\", username);\r","} else {\r","    console.warn(\"⚠️ 無法取得 username，請檢查回應格式\");\r","}\r","let jsonData = pm.response.json();\r","console.log(\"🔐 建立帳號 JSON Response:\", JSON.stringify(jsonData, null, 2));"],"type":"text/javascript","packages":{}}},{"listen":"prerequest","script":{"id":"fefb658f-8127-45d4-b501-0bdf45949a06","exec":["const requestBody = JSON.parse(pm.request.body.raw);\r","\r","pm.environment.set(\"uat_phoneNumber\",requestBody.username);"],"type":"text/javascript","packages":{}}}],"id":"c3a61723-8daa-4002-9dd2-de6a5c7fcad7","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"auth":{"type":"noauth"},"method":"POST","header":[{"key":"callType","value":"app","type":"text"},{"key":"lang","value":"zh-CN","type":"text"}],"body":{"mode":"raw","raw":"{\r\n  \"mobilePrefix\": \"86\",\r\n  \"password\": \"{{password}}\",\r\n  \"username\": \"{{mobilePhone}}\"\r\n}","options":{"raw":{"language":"json"}}},"url":{"raw":"{{prd}}/user/login","host":["{{prd}}"],"path":["user","login"],"query":[{"key":"","value":"","disabled":true}]}},"response":[],"uid":"37399927-c3a61723-8daa-4002-9dd2-de6a5c7fcad7"},{"name":"prd_updatePersonInfo(KYC)","event":[{"listen":"test","script":{"id":"49464483-7b0d-44e8-a923-d9962d8a19ce","exec":["let jsonData = pm.response.json();\r","console.log(\"🔐 更新KYC JSON Response:\", JSON.stringify(jsonData, null, 2));"],"type":"text/javascript","packages":{}}},{"listen":"prerequest","script":{"id":"0a0ac53d-f2bc-4855-a5d7-291b1a5005f7","exec":[],"type":"text/javascript"}}],"id":"3bea280d-291d-45f9-b094-c0c02fec25aa","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"POST","header":[{"key":"callType","value":"app","type":"text"},{"key":"token","value":"{{prd_token}}","type":"text"},{"key":"lang","value":"zh-CN","type":"text"}],"body":{"mode":"raw","raw":"{\r\n\t\"chineseName\": \"谭江\",\r\n\t\"lang\": \"zh_CN\",\r\n\t\"platForm\": \"android\",\r\n\t\"idDocumentNumber\": \"430203198507017511\",\r\n\t\"customerNo\": \"{{prd_username}}\",\r\n\t\"email\": \"\"\r\n}","options":{"raw":{"language":"json"}}},"url":{"raw":"{{prd}}/person/updatePersonInfo","host":["{{prd}}"],"path":["person","updatePersonInfo"]}},"response":[],"uid":"37399927-3bea280d-291d-45f9-b094-c0c02fec25aa"},{"name":"交易伺服器/user/login","event":[{"listen":"test","script":{"id":"2f4d818c-9560-48aa-9a57-b0cea2606b8d","exec":["pm.test(\"Content-Type header is application/json\", () => {\r","  pm.expect(pm.response.code).to.eql(200);\r","  pm.expect(pm.response.headers.get('Content-Type')).to.eql('application/json; charset=utf-8');\r","});\r","\r","pm.test(\"解析结果並保存登入資訊\", () => {\r","    let jsonData;\r","\r","    try {\r","        jsonData = pm.response.json();\r","    } catch (e) {\r","        console.error(\"⚠️ 無法解析 JSON 響應:\", e);\r","        return;\r","    }\r","\r","    // 驗證後端回傳是否成功\r","    pm.expect(jsonData.code).to.eql(0);\r","    pm.expect(jsonData.msg).to.eql(\"Login Success\");\r","\r","    // 儲存 token 至環境變數\r","    if (jsonData.token) {\r","        pm.environment.set(\"token1\", jsonData.token);\r","        console.log(\"✅ token 儲存成功:\", jsonData.token);\r","    } else {\r","        console.warn(\"⚠️ token 不存在\");\r","    }\r","\r","    // 儲存 account.userid 至環境變數\r","    if (jsonData.account && jsonData.account.account_groupid) {\r","        pm.environment.set(\"userid\", jsonData.account.account_groupid.toString());\r","        console.log(\"✅ userid 儲存成功:\", jsonData.account.userid);\r","    } else {\r","        console.warn(\"⚠️ account.userid 不存在\");\r","    }\r","});\r","\r","pm.test(\"Save account.id to environment variable\", function () {\r","    let jsonData = pm.response.json();\r","\r","    // Check if account and id exist\r","    if (jsonData.account && jsonData.account.id !== undefined) {\r","        pm.environment.set(\"ID\", jsonData.account.id);\r","        console.log(\"✅ ID 儲存成功:\", jsonData.account.id);\r","    } else {\r","        console.warn(\"account.id not found in response\");\r","    }\r","\r","    pm.expect(jsonData.code).to.eql(0);  // Optional: validate success\r","});"],"type":"text/javascript","packages":{}}},{"listen":"prerequest","script":{"id":"d99f447b-1d43-46dc-afe0-afccbfc7fbfc","exec":[""],"type":"text/javascript","packages":{}}}],"id":"240b5ecd-9950-4186-be48-afec8f1cf204","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"POST","header":[{"key":"Content-Type","value":"application/json; charset=utf-8","type":"text"}],"url":{"raw":"{{prd_mtrade}}/user/login?customer_no={{prd_username}}&password=aa123456&company_id=1","host":["{{prd_mtrade}}"],"path":["user","login"],"query":[{"key":"customer_no","value":"{{prd_username}}"},{"key":"password","value":"aa123456"},{"key":"company_id","value":"1"}]}},"response":[],"uid":"37399927-240b5ecd-9950-4186-be48-afec8f1cf204"},{"name":"查看點差","event":[{"listen":"test","script":{"id":"d86b24a2-d539-476d-90ed-af0c7817173b","exec":["pm.test(\"Extract XAUUSD price\", function () {\r","    const jsonData = pm.response.json();\r","\r","    const target = jsonData.find(item => item.symbol === \"XAUUSD\");\r","\r","    if (target && target.price) {\r","        pm.environment.set(\"price\", target.price);\r","        console.log(\"✅ Found XAUUSD price:\", target.price);\r","    } else {\r","        console.warn(\"⚠️ XAUUSD symbol not found or price missing.\");\r","    }\r","});\r",""],"type":"text/javascript","packages":{}}},{"listen":"prerequest","script":{"id":"2d77cf83-86af-4431-ad1f-5352f529d57f","exec":[""],"type":"text/javascript","packages":{}}}],"id":"c4e4ea32-c1f8-4546-9002-2564a06b3894","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"GET","header":[],"url":{"raw":"https://39.108.7.68:9090/api/v1/marketprice?company=1&timeformat=1","protocol":"https","host":["39","108","7","68"],"port":"9090","path":["api","v1","marketprice"],"query":[{"key":"company","value":"1"},{"key":"timeformat","value":"1"}]}},"response":[],"uid":"37399927-c4e4ea32-c1f8-4546-9002-2564a06b3894"},{"name":"開倉 /account/openposition","event":[{"listen":"test","script":{"id":"638f6094-7c57-42b4-9860-cc99aedd3333","exec":["pm.test(\"Extract position volume and order_refid\", function () {\r","    const jsonData = pm.response.json();\r","\r","    if (jsonData.position) {\r","        if (jsonData.position.volume !== undefined) {\r","            pm.environment.set(\"volume\", jsonData.position.volume);\r","            console.log(\"✅ Saved volume:\", jsonData.position.volume);\r","        }\r","\r","        if (jsonData.position.order_refid !== undefined) {\r","            pm.environment.set(\"positionid\", jsonData.position.id);\r","            console.log(\"✅ Saved positionid:\", jsonData.position.order_refid);\r","        }\r","    } else {\r","        console.warn(\"⚠️ No 'position' object found in response.\");\r","    }\r","});\r","let jsonData = pm.response.json();\r","console.log(\"🔐 開倉 JSON Response:\", JSON.stringify(jsonData, null, 2));"],"type":"text/javascript","packages":{}}},{"listen":"prerequest","script":{"id":"359d776b-f656-49ee-a6e1-85b463367e7f","exec":[""],"type":"text/javascript","packages":{}}}],"id":"58633612-e2be-433f-a3db-3b551b8152da","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"POST","header":[],"url":{"raw":"{{prd_mtrade}}/account/openposition?token={{token1}}&accountid={{ID}}&direction=2&symbol=GWFX/USD/GTS/MM/MIN/0/A/XAUUSD&request_volume=0.01&request_price={{price}}&stop_loss=0&take_profit=0&refid=0&ref_accid=0&range=1000&client_type=17","host":["{{prd_mtrade}}"],"path":["account","openposition"],"query":[{"key":"token","value":"{{token1}}"},{"key":"accountid","value":"{{ID}}"},{"key":"direction","value":"2"},{"key":"symbol","value":"GWFX/USD/GTS/MM/MIN/0/A/XAUUSD"},{"key":"request_volume","value":"0.01"},{"key":"request_price","value":"{{price}}"},{"key":"stop_loss","value":"0"},{"key":"take_profit","value":"0"},{"key":"refid","value":"0"},{"key":"ref_accid","value":"0"},{"key":"range","value":"1000"},{"key":"client_type","value":"17"}]}},"response":[],"uid":"37399927-58633612-e2be-433f-a3db-3b551b8152da"},{"name":"平倉 /account/closeposition","event":[{"listen":"test","script":{"id":"292c3aac-b1f0-40a0-b633-3043919b6155","exec":["let jsonData = pm.response.json();\r","console.log(\"🔐 平倉 JSON Response:\", JSON.stringify(jsonData, null, 2));"],"type":"text/javascript","packages":{}}},{"listen":"prerequest","script":{"id":"c6e9bd04-52fc-494e-8e51-a4e95dfe67e9","exec":[],"type":"text/javascript"}}],"id":"f896d46e-eb83-4bb1-b104-6c55f0d54d11","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"POST","header":[],"url":{"raw":"{{prd_mtrade}}/account/closeposition?token={{token1}}&accountid={{ID}}&direction=2&symbol=GWFX/USD/GTS/MM/MIN/0/A/XAUUSD&request_volume={{volume}}&request_price={{price}}&stop_loss=0&take_profit=0&refid=0&ref_accid=0&range=1000&client_type=17&positionid={{positionid}}","host":["{{prd_mtrade}}"],"path":["account","closeposition"],"query":[{"key":"token","value":"{{token1}}"},{"key":"accountid","value":"{{ID}}"},{"key":"direction","value":"2"},{"key":"symbol","value":"GWFX/USD/GTS/MM/MIN/0/A/XAUUSD"},{"key":"request_volume","value":"{{volume}}"},{"key":"request_price","value":"{{price}}"},{"key":"stop_loss","value":"0"},{"key":"take_profit","value":"0"},{"key":"refid","value":"0"},{"key":"ref_accid","value":"0"},{"key":"range","value":"1000"},{"key":"client_type","value":"17"},{"key":"positionid","value":"{{positionid}}"}]}},"response":[],"uid":"37399927-f896d46e-eb83-4bb1-b104-6c55f0d54d11"},{"name":"获取当日成交/account/dealTodayList","event":[{"listen":"test","script":{"id":"94a143bd-7578-484a-b01a-35be97b63412","exec":["//console.log(\"🔐 Login Response:\");\r","//console.log(pm.response.text());\r","\r","let jsonData = pm.response.json();\r","console.log(\"🔐 當日成交 JSON Response:\", JSON.stringify(jsonData, null, 2));"],"type":"text/javascript","packages":{}}},{"listen":"prerequest","script":{"id":"ca29713e-c94e-4cff-b146-93b000d7f04d","exec":[],"type":"text/javascript"}}],"id":"3e71785f-e42d-4a0d-b119-0ad5e21aaa20","protocolProfileBehavior":{"disableBodyPruning":true},"request":{"method":"GET","header":[],"url":{"raw":"{{prd_mtrade}}/account/dealTodayList?accountid={{ID}}&token={{token1}}","host":["{{prd_mtrade}}"],"path":["account","dealTodayList"],"query":[{"key":"accountid","value":"{{ID}}"},{"key":"token","value":"{{token1}}"}]}},"response":[],"uid":"37399927-3e71785f-e42d-4a0d-b119-0ad5e21aaa20"}]}}